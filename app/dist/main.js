(()=>{"use strict";async function e(e,t,a){try{e=e.toLowerCase();let o={},n="";if("post"!=e&&"delete"!=e&&"put"!=e&&"get"!=e)throw"Método de envió de datos invalido";if(o.method=e,void 0!==a)if("get"==e||"delete"==e||"put"==e){n="?";for(let[e,t]of a.entries())n+=`${e}=${t}&`;n=n.slice(0,-1),"put"==e&&(o.body=n.slice(1),n="")}else o.body=a;const c=await fetch(`/public_html/meliScabiniDesarrollo/app/src/model/${e}/${e}${t}.php${n}`,o);return await c.json()}catch(e){console.log("error "+e)}}async function t(e,t){try{if(void 0===e)throw"No hay data para llenar la tabla";t.innerHTML="";const a=document.getElementById("tableRowTemplate").content,o=document.createDocumentFragment(),c=Object.entries(e.db);for(const[e,t]of c){a.querySelector(".tableRow").dataset.id=t.ID,a.querySelectorAll("td").forEach((e=>{let a=e.getAttribute("name");e.textContent=t[a]}));const e=a.cloneNode(!0);o.appendChild(e)}t.appendChild(o),(e.amountOfPages||document.querySelector("#pagerContainer").dataset.pages)>1&&c.length>0&&function(e,t){const a=document.getElementById("pagerContainer"),o=document.getElementById("pagerItemTemplate").content,n=document.createDocumentFragment(),[c,r]=function(e,t,a,o){const n=Math.floor(2.5);let c=t-n,r=parseInt(t)+n;if(a&&(o.dataset.pages=a),a=o.dataset.pages,o.innerHTML="",c<=0)for(c=1;r<5&&r<a;)r++;if(r>a){for(r=a;c>1&&c>a-5-1;)c--;r<1&&(r=1)}return[c,r]}(0,t,e,a);for(let e=c;e<=r;e++){o.querySelector("a").innerHTML=e,o.querySelector(".page-item").dataset.id=e;const t=o.cloneNode(!0);n.appendChild(t)}a.appendChild(n);const s=a.querySelector(".page-item .active");s&&s.classList.remove(".active"),a.querySelector('.page-item[data-id="'+t+'"]').classList.add("active")}(e.amountOfPages,e.currentPage),n(e.msg)}catch(e){console.log("error "+e)}}async function a(t){try{const a=t.dataset.file,o=void 0===t.dataset.default?" ":t.dataset.default,n=new FormData;let c="";c+="<option value='default'>"+o+"</option>",void 0!==t.dataset.condition&&n.append("condition",t.dataset.condition),e("get",a,n).then((e=>{e.forEach((e=>{c+='<option value="'+e[0]+'">'+e[1]+"</option>"})),t.innerHTML=c,t.options[0].selected=!0}))}catch(e){console.log("error "+e)}}function o(){var e=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(e).forEach((function(e){e.addEventListener("submit",(function(t){e.checkValidity()||(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")}),!1)}))}async function n(e){try{const t=e.type,a=e.text,o=document.getElementById("alertContainer"),n={success:{icon:"bxs-check-circle",color:"alert-success"},info:{icon:"bxs-info-circle",color:"alert-primary"},error:{icon:"bxs-error",color:"alert-danger"}},c=document.getElementById("alertTemplate").content;let r=parseInt(c.querySelector(".alert").dataset.id),s=c.cloneNode(!0);c.querySelector(".alert").dataset.id=r+1,s.querySelector(".alert").classList.add(n[t].color),s.querySelector("i").classList.add(n[t].icon),s.querySelector("span").textContent=a,o.appendChild(s),setTimeout((()=>{const e=o.querySelector('.alert[data-id="'+r+'"]');e&&new bootstrap.Alert(e).close()}),2500)}catch(e){console.log("error "+e)}}async function c(t){let n=t.dataset.title,c=t.dataset.file,l=t.dataset.id;await async function(e,t){try{document.getElementById("alertContainer").innerHTML="";const a=document.getElementById("sectionTitle"),o=document.getElementById("pageContainer"),n=await fetch(e),c=await n.text();o.innerHTML=c,a.innerHTML=t}catch(e){console.log("error "+e)}}(`./view/pages/menu/${c}`,n).then((()=>{r(),async function(){try{document.querySelectorAll(".getSelectOption").forEach((e=>{a(e)}))}catch(e){console.log("error "+e)}}(),function(){try{document.querySelectorAll(".cardContainer").forEach((t=>{t.innerHTML="";const a=document.querySelectorAll(t.dataset.tpl).content,o=document.createDocumentFragment(),n=t.dataset.file,c=t.dataset.id,r=new FormData;if(c&&r.append("id",c),void 0===n)throw"No hay archivo para buscar la data";e("get",n,r).then((e=>{if(void 0===e.db)throw"No hay data";const t=Object.entries(e.db);for(const[e,n]of t){const t=a.querySelector(`.${n[e]}`);t&&(t.textContent=n[e]);const c=a.cloneNode(!0);o.appendChild(c)}})),t.appendChild(o)}))}catch(e){console.log("error "+e)}}(),o(),l&&async function(t){try{const a=document.querySelectorAll(".fillForm"),o=new FormData;o.append("id",t),a.forEach((a=>{const n=a.dataset.file,c=a.querySelector("button[type=submit]"),r=d(a);if(i(r,t),void 0===n)throw"No hay archivo para buscar la data";e("get",n,o).then((e=>{if(void 0===e.db)throw"No hay data";const t=a.querySelectorAll("input"),o=a.querySelectorAll("select");t.forEach((t=>{const a=t.getAttribute("name");t.value=e.db[0][a]})),o.forEach((t=>{const a=t.getAttribute("name"),o=e.db[0][a];null!==o&&(t.value=o)})),void 0!==e.msg&&"error"===e.msg.type||s(c),void 0!==e.id&&i(r,e.id)}))}))}catch(e){console.log("error "+e)}}(l)}))}async function r(a=null){try{const o=document.querySelector(".loadTable"),n=new FormData;if(a&&n.append("pageNumber",a),o){const a=o.dataset.file,c=await e("get",a,n);await t(c,o)}}catch(e){console.log("error "+e)}}async function s(e){try{"Guardar"===e.innerHTML&&(e.innerHTML="Actualizar",e.classList.replace("postInformation","putInformation"))}catch(e){console.log("error "+e)}}async function l(t,a){try{const[o,c,r,l]=function(e){try{const t=e.submitter,a=t.dataset.file,o=e.target,n=new FormData(o);return o.dataset.id&&n.append("id",o.dataset.id),[t,a,o,n]}catch(e){console.log("error "+e)}}(a),u=await e(t,c,l);if("post"===t)if(o.classList.contains("authentificationForm")&&"success"==u.msg.type){const e=o.dataset.redirect;window.location.href=e}else i(d(r),u.id),"success"==u.msg.type&&await s(o);n(u.msg)}catch(e){console.log("error "+e)}}function i(e,t){try{e.forEach((e=>{e.dataset.id=t}))}catch(e){console.log("error "+e)}}function d(e){try{const t=[e];return e.dataset.forms&&e.dataset.forms.split(",").forEach((e=>{const a=document.querySelector(e);t.push(a)})),t}catch(e){console.log("error "+e)}}function u(e,t,a=!0){const o=e.parentNode,n=document.getElementById("badgeContainer"),c=n.querySelector('.badgeElement[data-id="'+t+'"]'),r=e.querySelector("select")||e.querySelector("input")||e;r.matches("select")&&(r.options[0].selected=!0,o.children.length>1&&t>=5&&a&&o.removeChild(e)),r.matches("input")&&(r.value=""),c&&n.removeChild(c)}async function m(e){try{const t=document.getElementById("datalistTemplate").content,o=document.createDocumentFragment(),n=parseInt(t.querySelector(".datalistGrouping").dataset.id)+1,c=e.dataset.condition,r=e.dataset.name,s=e.dataset.file;t.querySelector(".datalistGrouping").dataset.id=n,t.querySelector("select").id="list"+n,t.querySelector("select").name=r,o.appendChild(t.cloneNode(!0)),e.appendChild(o);const l=e.querySelector('.datalistGrouping[data-id="'+n+'"] select');l.dataset.condition=c,l.dataset.file=s,a(l)}catch(e){console.log("error "+e)}}document.addEventListener("DOMContentLoaded",(()=>{!async function(){const e=document.querySelector(".sidebar");e&&(document.getElementById("btn").addEventListener("click",(()=>{e.classList.toggle("active"),btn.classList.contains("bx-menu")?btn.classList.replace("bx-menu","bx-menu-alt-right"):btn.classList.replace("bx-menu-alt-right","bx-menu")})),document.querySelector(".bx-search").addEventListener("click",(()=>{e.classList.toggle("active")})))}(),o(),document.addEventListener("click",(e=>{if(e.target.matches(".link_nav , .link_nav *")&&c(e.target.closest(".link_nav")),e.target.matches(".tableRow , .tableRow *")&&c(e.target.closest(".tableRow")),e.target.matches(".changeSectionButton , .changeSectionButton *")){const t=e.target.closest(".changeSectionButton"),a=t.querySelector("i");c(t).then((()=>{a.matches(".bx-slider-alt")&&async function(){document.querySelectorAll(".addDatalistGroupingFromFilterMenu").forEach((e=>{m(document.querySelector(e.dataset.bsTarget))}))}()}))}if(e.target.matches(".badgeElement i.bx-x-circle")){const t=e.target.closest(".badgeElement").dataset.id;u(document.querySelector('#containerFilterElements [data-id="'+t+'"]'),t)}if(e.target.matches("#btnLogout, #btnLogout *")&&fetch("./model/logout.php"),e.target.matches(".btn-datalist *, .btn-datalist")){const t=e.target.closest(".btn-datalist").querySelector("i");if(t.matches(".bx-plus")&&m(e.target.closest(".tab-pane")),t.matches(".bx-minus")){const t=e.target.closest(".datalistGrouping");u(t,t.dataset.id)}}if(e.target.matches(".page-item, .page-item *")&&r(e.target.closest(".page-link").innerHTML),e.target.matches("#show_password, #show_password *")){const t=e.target.closest("#show_password"),a=t.querySelector(".icon");!function(e,t){"password"==e.type?(e.type="text",t.classList.replace("fa-eye-slash","fa-eye")):(e.type="password",t.classList.replace("fa-eye","fa-eye-slash"))}(t.closest(".passwordContainer").querySelector("#passwordInput"),a)}}))})),document.addEventListener("change",(e=>{if(e.target.matches(".datalistGrouping select, input.filterInput,  select.filterInput")){let[t,a,o]=function(e){const t=e.target.closest("[data-id]"),a=t.dataset.id;let o;const n=t.querySelector("select")||t.querySelector("input")||t;if(n.matches("select")){o=n.options[n.selectedIndex].text;const e=n.closest(".tab-pane");if(e){const t=e.querySelectorAll("select");let a=0;t.forEach((e=>{e.options[e.selectedIndex].text==o&&(a+=1)})),a>1&&(o="",n.options[0].selected=!0)}}return n.matches("input")&&(o=n.value),[o,a,t]}(e);!function(e,t,a){const o=document.querySelector('.badgeElement[data-id="'+e+'"]');""==t?o&&u(a,e,!1):o?o.querySelector("span").textContent=t:function(e,t){const a=document.getElementById("badgeContainer"),o=document.createDocumentFragment(),n=document.getElementById("badgeTemplate").content.cloneNode(!0);n.querySelector("span").textContent=e,n.querySelector("button").dataset.id=t,o.appendChild(n),a.appendChild(o)}(t,e)}(a,t,o)}})),document.addEventListener("submit",(a=>{a.preventDefault(),a.target.matches(".searchFormulary")&&async function(a){try{const o=a.target,n=a.submitter.dataset.file,c=new FormData(o),r=document.querySelector(".loadTable");console.log(c.get("id")),e("get",n,c).then((e=>t(e,r)))}catch(e){console.log("error "+e)}}(a),a.submitter.matches(".postInformation")&&l("post",a),a.submitter.matches(".putInformation")&&l("put",a),a.submitter.matches(".deleteInformation")&&l("delete",a),a.submitter.matches(".searchInformation")&&l("get",a),a.target.matches(".searchPatientsByFilter")&&async function(t){const a=t.target;e("get",t.submitter.dataset.file,new FormData(a)).then((e=>console.log(e)))}(a)}))})();