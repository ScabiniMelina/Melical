<?php
include("./../connection.php");
$dni = getInputValue($_POST['tramitNumber'], ' El dni', 8, 'integer', 8);
$cuilFirstCharacters = getInputValue($_POST['cuilFirstCharacters'], 'La primera parte del  CUIL', 2, 'integer', 2);
$cuilLastCharacters = getInputValue($_POST['cuilLastCharacters'], 'La ultima parte del  CUIL', 1, 'integer', 1);
$cuil = $cuilFirstCharacters . $dni . $cuilLastCharacters;
$name = $_POST['name'];
$surname = $_POST['surname'];
$dateBirth = $_POST['dateBirth'];
$gender = setSelectValue($_POST['gender']);
$phone = $_POST['phone'];
$email = $_POST['email'];
$address = $_POST['address'];
$addressNumber = $_POST['addressNumber'];
$location = setSelectValue($_POST['location']);
$id = getMd5Id("Personal_Information", "ID_DNI");
//Revisa si ya hay un registro con los datos del paciente registrado;
$sql = "SELECT COUNT(*) AS numberOfMatches FROM  Personal_Information  WHERE `cuil` = ?";
$typeOfParameters = "i";
$parameters = array($cuil);
$result = executePreparedStatement($sql, $typeOfParameters, $parameters);
$data =  getResultOfPreparedStatement($result);
setMessageOfDuplicateRecord($data, 'un paciente');
$sql = "INSERT INTO Personal_Information (ID_DNI,dni,cuil,name,surname,gender,date_Birth,phone,email,adress,adress_number,PK_Location) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)";
$typeOfParameters = "siissssissii";
$parameters = array($id, $dni, $cuil, $name, $surname, $gender, $dateBirth, $phone, $email, $address, $addressNumber, $location);
$result = executePreparedStatement($sql, $typeOfParameters, $parameters);
sendJson(null, $msg, $id, null, null);
